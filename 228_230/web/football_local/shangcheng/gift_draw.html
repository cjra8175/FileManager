<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
	    <meta name="apple-mobile-web-app-capable" content="yes">
	    <meta name="apple-mobile-web-app-status-bar-style" content="black">
	    <meta name="format-detection" content="telephone=no">
		<title>大转盘</title>
		<link href="../css/mall.css" type="text/css" rel="stylesheet">
	</head>
	<body>
		<div id="loading-new">
			<div id="loading-new-center">
				<div id="loading-new-center-absolute">
					<div class="object" id="loading"></div>
				</div>
			</div>
		</div>
		<section class="mall-content lp-center">
			<header class="mall-header">
				<span class="mall-return"></span>
				<h2 class="mall-ttile">大转盘</h2>
				<span class="dh-icon"></span>
			</header>
			<div class="mall-box">
				<div class="mall-user hide clearfix">
					<div class="user-left">
						<img src="http://www.buyinball.com/img/46dace1f5cb94a36aeffb1eaef092cf2_100x100.png" class="user-img">
						<span class="user-name"></span>
					</div>
					<div class="gift-money">
						<span class="user-jb">
							<i class="jb"></i>
							<em class="money-count"></em>
						</span>
					</div>
				</div>
				
				<div class="mall-sunav hide">
					<ul>
						<li class="play-rule">玩法规则</li>
						<li class="reward-record">奖品记录</li>
						<li class="goods-address">收货地址</li>
					</ul>
				</div>
				
				<div class="gift-broadcost">
					<div class="broadcost">
						<ul>

						</ul>
					</div>
				</div>
				<div class="draw-bg"></div>
				<div class="gift-date">本期截止时间: <span id="lotteryTime"></span></div>
			
				
				<div class="draw-box">
					<div class="draw-footer"></div>
					<div class="draw-c1" id="lottery_reward"></div>
					<div class="draw-c2" id="lottery_bg"></div>
					<div class="draw-btn"><span class="draw-jb hide">金币/次</span></div>
					<div class="draw-light hide"></div>
					<div class="draw-select hide"></div>
				</div>
				<div class="draw-wait hide">
					<div class="draw-wait-pic"></div>
				</div>
				
			</div>
			<article class="mall-article" style="padding-top:0">
				客服QQ：2111955973<br>
				客服邮箱：buyinball@pchittech.com
			</article>
			<div class="ceng-bg hide"></div>
			
			<div class="ceng-weebox play-rule-box hide">
				<div class="ceng-top">
					<div class="ceng-title">玩法规则</div>
					<span class="ceng-close"></span>
				</div>
				<article class="rules-box gameContentRule">

				</article>
			</div>
			
			
			<div class="ceng-weebox pay-success hide">
				<div class="suc-title">支付成功！</div>
				<div class="ceng-hd"></div>
				<div class="ceng-action">
					<span class="ceng-btn2">确定</span>
				</div>
			</div>
			

			
			<div class="ceng-weebox tip-box hide">
				<div class="ceng-top">
					<div class="ceng-title">提示</div>
					<span class="ceng-close"></span>
				</div>
				<div class="ceng-tips"></div>
				<div class="ceng-action">
					<span class="btn1 ceng-btn1">再看看</span>
					<span class="btn2 ceng-btn2">马上去</span>
				</div>
			</div>
			
		</section>
		<script src="../js/lib/zeptoPpLoadNativeMap.min.js"></script>
		<script src="../js/main.js"></script>
		<script src="../js/lib/fx.js"></script>
		<script src="../js/lib/awardRotate.js"></script>
		<script>/iPhone|iPad|iPod|ios|IOS/.test(window.navigator.userAgent)&&(812==document.documentElement.clientHeight&&375==document.documentElement.clientWidth?($(".mall-header").css({"padding-top":"40px"}),$(".mall-box").css({"padding-top":"88px"}),$(".mall-sunav").css("top","88px")):($(".mall-header").css({"padding-top":"16px"}),$(".mall-box").css({"padding-top":"64px"}),$(".mall-sunav").css("top","64px"))),$.fn.scrollText=function(t){var e={sBox:".box",speed:4e3},t=$.extend(e,t);this.each(function(){var t=$(this).height(),n={scrollUp:function(){$(e.sBox).animate({marginTop:-t+"px"},500,function(){$(e.sBox).css("margin-top",0),$(e.sBox).find("li").eq(0).appendTo($(e.sBox).find("ul"))})}};setInterval(function(){n.scrollUp()},e.speed)})};var Init=function(){var t=function(){o(),n(),T.Util.isEmpty(T.Storage.get("access_token"))||Lottery.getFreeCjCount(),Lottery.getData(),e()},e=function(){$(".dh-icon").off().Touch(function(){$(".ceng-bg,.mall-sunav").removeClass("hide")}),$(".play-rule").off().Touch(function(){$(".mall-sunav").addClass("hide"),$(".play-rule-box").removeClass("hide")}),$(".reward-record").off().Touch(function(){if($(".ceng-bg,.mall-sunav").addClass("hide"),T.Util.isEmpty(T.Storage.get("access_token")))return void T.Util.login();T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/shangcheng/notesDetail.html?type=CJ")}),$(".goods-address").off().Touch(function(){if($(".ceng-bg,.mall-sunav").addClass("hide"),T.Util.isEmpty(T.Storage.get("access_token")))return void T.Util.login();T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/shangcheng/address.html?type=CJ")}),$(".play-rule-box .ceng-close").off().Touch(function(){$(".play-rule-box,.ceng-bg").addClass("hide")}),$(".ceng-close").off().Touch(function(){$(".ceng-weebox,.ceng-bg").addClass("hide")}),$(".tip-box .ceng-btn1").off().Touch(function(){$(".tip-box,.ceng-bg").addClass("hide")}),$(".pay-success .ceng-btn2").off().Touch(function(){$(".pay-success,.ceng-bg").addClass("hide")}),$(".mall-return").off().Touch(function(){T.Util.isEmpty(T.Util.getPara("source"))||T.Storage.set("backToIndex",1),Global.isAndroid&&T.Storage.remove("backToIndex"),T.Util.back()}),$(".user-jb").off().Touch(function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/app/accounts_jb.html?from=web")}),$(".ceng-bg").off().Touch(function(){$(".ceng-weebox,.ceng-bg,.mall-sunav").addClass("hide")}),$(".draw-btn").off().Touch(function(){return T.Util.isEmpty(T.Storage.get("access_token"))?void T.Util.login():!!Lottery.canLottery&&(!T.Util.isEmpty($(".draw-btn").attr("free_num"))&&parseInt($(".draw-btn").attr("free_num"))>0?(Lottery.doLottery(function(){var t=parseInt($(".draw-btn").attr("free_num"));t--,t<=0?($(".draw-btn").removeAttr("free_num"),$(".draw-jb").html(Math.floor(Lottery.base_price)+"金币/次")):($(".draw-btn").attr("free_num",t),$(".draw-jb").html("免费抽奖"+t+"次"))}),!1):void T.Util.xmlHttpRequest({type:"get",reqUrl:"/auth-web/api/user/get_user?access_token="+T.Storage.get("access_token"),callback:function(t){var e=t.get_user.coin;if(parseInt(e)<Math.floor(Lottery.base_price))return void Init.tipMsg("您的金币不足，前往充值？",function(){$(".tip-box,.ceng-bg").addClass("hide"),T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/shangcheng/shoppingMall.html?type=JB")});Init.tipMsg("本次抽奖将花费您"+Lottery.base_price+"金币",function(){Lottery.doLottery(),$(".tip-box,.ceng-bg").addClass("hide")})},errorCallback:function(){}}))})},n=function(){T.Util.xmlHttpRequest({type:"get",reqUrl:"/forum/api/shop/qry_shop_tips?obj_type=2",callback:function(t){for(var e=[],n=t.qry_shop_tips.data,o=0;o<n.length;o++)e.push("<li>恭喜<span>"+n[o].nick_name+"</span>获得<span>"+n[o].name+"</span></li>");$(".broadcost ul").html(e.join("")),$(".gift-broadcost").scrollText({sBox:".broadcost",speed:3e3})},errorCallback:function(){}})},o=function(){if(!T.Util.isEmpty(T.Storage.get("access_token"))){var t=T.Storage.get("userinfo");$(".user-name").html(t.nick_name),$(".user-img").attr("src",t.portrait_pic),$(".zs-count").html(T.Util.parseNumber(t.diamend)),$(".money-count").html(T.Util.parseNumber(t.coin)),$(".mall-user").removeClass("hide")}};return{init:t,checkUserInfo:o,tipMsg:function(t,e,n){$(".ceng-tips").html(t),$(".tip-box .btn1").removeClass("ceng-btn1 ceng-btn2").addClass("ceng-btn1"),$(".tip-box .btn2").removeClass("ceng-btn1 ceng-btn2").addClass("ceng-btn2"),$(".tip-box .ceng-btn1").html(n&&n.firstBtnTitle||"再看看"),$(".tip-box .ceng-btn2").html(n&&n.secondBtnTitle||"马上去"),n&&n.reverse&&($(".tip-box .btn1").removeClass("ceng-btn1 ceng-btn2").addClass("ceng-btn2"),$(".tip-box .btn2").removeClass("ceng-btn1 ceng-btn2").addClass("ceng-btn1"),$(".tip-box .ceng-btn1").html(n&&n.firstBtnTitle||"马上去"),$(".tip-box .ceng-btn2").html(n&&n.secondBtnTitle||"再看看")),$(".tip-box .ceng-btn1").off().Touch(function(){$(".tip-box,.ceng-bg").addClass("hide")}),$(".tip-box .ceng-btn2").off().Touch(function(){e&&e()}),$(".tip-box,.ceng-bg").removeClass("hide")},tipSuccess:function(t,e,n){n&&$(".suc-title").html(n),$(".pay-success .ceng-hd").html(t),$(".pay-success,.ceng-bg").removeClass("hide")}}}(),Lottery=function(){var t={};t.recordMapping=[],t.rewards={},t.canLottery=!0;var e=!1,n=function(t,e){return 360/e*(t-1)},o=function(e){for(var n=t.recordMapping.length,o=0;o<t.recordMapping.length;o++)if(t.recordMapping[o]==e){n=o+1;break}return n};return t.rotateFn=function(a){$(".draw-select").addClass("hide");var r=o(a);angles=n(r,t.recordMapping.length),Lottery.lightAngles=360-angles,e=!e,$("#lottery_bg").stopRotate(),$("#lottery_reward").stopRotate(),$("#lottery_bg").rotate({angle:0,animateTo:1800-angles,duration:3e3}),$("#lottery_reward").rotate({angle:0,animateTo:1800-angles,duration:3e3,callback:function(){$(".draw-select").removeClass("hide"),e=!e,Lottery.canLottery=!0,setTimeout(function(){Init.tipMsg("恭喜您，抽中了"+a+"<br>更多幸运大奖在等您",function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/shangcheng/notesDetail.html?type=CJ")},{firstBtnTitle:"知道了",secondBtnTitle:"查看",reverse:1})},300)}})},t.rotateLight=function(){function e(){n+=30,Lottery.checkFlag&&n%Lottery.lightAngles==0?($(".draw-light").addClass("hide"),window.clearInterval(t.lightGo),Lottery.checkFlag=!1):$(".draw-light").css("-webkit-transform","rotate("+n+"deg)")}$(".draw-select").addClass("hide"),$(".draw-light").css("transform","rotate(0deg)").removeClass("hide");var n=0;window.clearInterval(t.lightGo),t.lightGo=setInterval(function(){e()},150)},t.getFreeCjCount=function(){var t="/forum/api/acct/qry_lottery_rest_num?obj_type=1&access_token="+T.Storage.get("access_token");T.Util.xmlHttpRequest({type:"get",reqUrl:t,callback:function(t){t.qry_lottery_rest_num&&t.qry_lottery_rest_num.unit_num&&($(".draw-btn").attr("free_num",t.qry_lottery_rest_num.unit_num),$(".draw-jb").html("免费抽奖"+t.qry_lottery_rest_num.unit_num+"次").removeClass("hide"))},errorCallback:function(){}})},t.getData=function(){var e="/forum/api/shop/qry_lottery?obj_type=1";T.Util.isEmpty(T.Storage.get("access_token"))||(e="/forum/api/shop/qry_lottery?obj_type=1&access_token="+T.Storage.get("access_token")),T.Util.xmlHttpRequest({type:"get",reqUrl:e,callback:function(e){var n=e.qry_lottery.data,o=e.qry_lottery;if(t.base_price=o.base_price,!n||12!=n.length)return $(".draw-box").addClass("hide"),void $(".draw-wait").removeClass("hide");t.doHtml(n,o),$("#loading-new").hide()},errorCallback:function(){$(".draw-box").addClass("hide"),$(".draw-wait").removeClass("hide")}})},t.doHtml=function(e,n){T.Util.isEmpty($(".draw-btn").attr("free_num"))&&$(".draw-jb").html(Math.floor(n.base_price)+"金币/次").attr("base-price",Math.floor(n.base_price)).removeClass("hide"),T.Util.isEmpty(n.act_pic)||$(".draw-c2").css({background:"url("+n.act_pic+") no-repeat 0 0","background-size":$(".draw-c2").css("background-size")}),$(".gameContentRule").html(n.obj_desc),$("#lotteryTime").html(new Date(n.end_time).format("YYYY年MM月dd日 hh:mm")),e.length&&(t.rewards=e,t.recordMapping=[],$.each(e,function(e,n){t.recordMapping.push(n.obj_name)}))},t.doLottery=function(t){if(!Lottery.canLottery)return!1;Lottery.canLottery=!1;var e={obj_type:"1",price:Lottery.base_price,access_token:T.Storage.get("access_token")};T.Util.xmlHttpRequest({reqUrl:"/forum/api/acct/activity_pay",type:"post",timeout:8e3,reqData:e,callback:function(e){T.User.getUInfo(T.Storage.get("access_token"),Init.checkUserInfo);e.activity_pay.obj_id;return Lottery.rotateFn(e.activity_pay.obj_name),t&&t(),!1},errorCallback:function(){Lottery.canLottery=!0},interfaceError:function(){Lottery.canLottery=!0,tip("网络异常")}})},t}();$(document).ready(function(){T.isNative?T.appToH5.init(Init.init):Init.init()})</script>
	</body>
</html>
