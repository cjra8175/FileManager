<!DOCTYPE html>
<html style="font-size:12px">
<head lang="en">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0">
    <meta content="telephone=no" name="format-detection">
    <meta name="msapplication-tap-highlight" content="no">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="cleartype" content="on">
    <title>滚球游戏详情</title>
    <link rel="stylesheet" href="../canvas/scene.css" type="text/css" media="screen">
    
    <script type="text/javascript" src="../js/lib/NativeApi.js"></script>
    <style>body{background:#fff;margin:0;padding:0}body,html{height:100%;width:100%}#tipBox{display:none}.timeDown{width:55px;height:18px;background:url(../img/timebg.png) no-repeat;background-size:55px auto;position:absolute;left:50%;color:#bcbcbc;font-size:12px;z-index:9;margin-left:-27.5px;text-align:center;line-height:18px;font-weight:700}</style>
</head>
<body>
<section>
    
    <section style="margin:0">
        <canvas id="canvas" style="width:100%;height:auto;min-height:150px"></canvas>
        <img class="hidden" id="field" src="../canvas/images/field.png">
        <img class="hidden" id="soccer" src="../canvas/images/soccer.png">
        <img class="hidden" id="offsideflag" src="../canvas/images/flag_offside.png">
        <img class="hidden" id="shootoffflag" src="../canvas/images/flag_shootoff.png">
        <img class="hidden" id="shootflag" src="../canvas/images/flag_shoot.png">
	<img class="hidden" id="kickoff" src="../canvas/images/kickoff.png">
    </section>
</section>

<script src="../js/lib/zeptoPpLoadNativeMap.min.js"></script>
<script src="../js/lib/android-wsMqttws31.min.js"></script>
<script src="../canvas/paper-full.js"></script>
<script src="../canvas/scene.js"></script>
<script>
function PlayTimer(t, a, e) {
	this.timerStartFlag = Math.random(), this.halfTimerFlag = Math.random(), this.firstHalfFlag = Math.random(), this.secondHalfFlag = Math.random(), this.mId = e, this.mStatus = t, this.second = a, this.firstTimerLoading = !0, this.secondTimerLoading = !0, this.halfTimerLoading = !0
}
var mineFlag = "0",
	playTimer = {};
PlayTimer.prototype.timerStart = function() {
	clearInterval(this.timerStartFlag);
	var t = this;
	this.timerStartFlag = setInterval(function() {
		t.timeAdd(t)
	}, 1e3)
}, PlayTimer.prototype.timeAdd = function(t) {
	var a = $("article.timeDown");
	if ($(a).length) {
		var e = $(a).attr("value");
		e = parseInt(e) + 1, $(a).attr("value", e), $(a).html(t.parseRtimeToSecond(e, t.mStatus)), e >= 2580 && "2" == t.mStatus && t.firstTimerLoading ? (t.firstTimerLoading = !1, t.firstHalfFlag = setInterval(function() {
			t.getPlayStatus(t)
		}, 1e4), $("dl").has($("ul[p_type='10']")).remove()) : e >= 5280 && "4" == t.mStatus && t.secondTimerLoading ? (t.secondTimerLoading = !1, t.secondHalfFlag = setInterval(function() {
			t.getPlayStatus(t)
		}, 1e4)) : "3" == t.mStatus && t.halfTimerLoading ? (t.halfTimerLoading = !1, t.halfTimerFlag = setInterval(function() {
			t.getPlayStatus(t)
		}, 3e4)) : e >= 5340 && "4" == t.mStatus && $("dl").has($("ul[p_id]")).remove()
	}
}, PlayTimer.prototype.getPlayStatus = function(t) {
	T.Util.xmlHttpRequest({
		type: "get",
		reqUrl: "/web/services/match/state.json?m_id=" + t.mId + "&random=" + Math.random(),
		callback: function(a) {
			void 0 !== a.res_data && a.res_data.length && parseInt(a.res_data[0].m_status) >= parseInt(t.mStatus) && ("2" == t.mStatus ? (clearInterval(t.firstHalfFlag), t.firstTimerLoading = !0) : "4" == t.mStatus ? (clearInterval(t.secondHalfFlag), t.secondTimerLoading = !0) : "3" == t.mStatus && (clearInterval(t.halfTimerFlag), t.halfTimerLoading = !0, matchEvent("HALF_END", "", "")), clearInterval(t.timerStartFlag), t.mId = a.res_data[0].m_id, t.mStatus = a.res_data[0].m_status, t.second = a.res_data[0].r_time, $("article.timeDown").html(t.init(t)), $("article.timeDown").attr("id", t.mId + "|" + t.second + "|" + t.mStatus), $("article.timeDown").attr("value", t.second), -1 != "23489".indexOf(t.mStatus) && t.timerStart()), "5" == t.mStatus && (clearInterval(t.firstHalfFlag), clearInterval(t.secondHalfFlag), clearInterval(t.halfTimerFlag), clearInterval(t.timerStartFlag), matchEvent("FINISHED", "", ""), $("article.timeDown").html("比赛已结束"))
		},
		errorCallback: function(t) {}
	})
}, PlayTimer.prototype.parseRtimeToSecond = function(t, a) {
	var t = parseInt(t);
	if ("2" == a && t > 2700) return "45+";
	if ("4" == a && t > 5400) return "90+";
	if ("3" == a) return "半场结束";
	var e = parseInt((t / 60).toString().split(".")[0]),
		r = t % 60;
	return e = e < 10 ? "0" + e : e, r = r < 10 ? "0" + r : r, e + ":" + r
}, PlayTimer.prototype.init = function(t) {
	return "1" == t.mStatus ? "未开始" : -1 != "248".indexOf(t.mStatus) ? t.parseRtimeToSecond(t.second, t.mStatus) : "3" == t.mStatus ? "半场结束" : "5" == t.mStatus ? "已结束" : "6" == t.mStatus ? "比赛已取消" : "7" == t.mStatus ? "比赛改期" : "9" == t.mStatus ? "点球" : "10" == t.mStatus ? "暂停" : "11" == t.mStatus ? "腰斩" : "12" == t.mStatus ? "推迟开赛" : void 0
};
var Init = function() {
		return {
			init: function() {
				var t = T.Util.getPara("m_id");
				T.Util.xmlHttpRequest({
					type: "get",
					reqUrl: "/web/services/match/" + t + ".json?onlyLive=true",
					callback: function(a) {
						var e = a.res_data;
						initTeamName(e.ht_name, e.gt_name), $("#score").html(e.ht_score + ":" + e.gt_score), $(".timeDown").attr("id", t + "|" + e.r_time + "|" + e.m_status), $(".timeDown").attr("value", e.r_time), playTimer = new PlayTimer(e.m_status, e.r_time, t), -1 != "23489".indexOf(e.m_status) && playTimer.timerStart();
						var r = [];
						r.push("G/E/1/" + t);
						try {
							T.Util.mqtt(r, Init.onMessageArrived)
						} catch (t) {}
					},
					errorCallback: function() {}
				})
			},
			onMessageArrived: function(t) {
				if (console.log(t.payloadString), t.payloadString && "" != t.payloadString) {
					var a = JSON.parse(t.payloadString);
					a.mId;
					switch ("" + a.msgType) {
					case "1":
						matchEvent(a.evtCd, a.tFlg, a.evtCont)
					}
					delete a
				}
			}
		}
	}();
$(document).ready(function() {
	Init.init()
})
</script>
<script src="../js/main.js"></script>
</body>
</html>