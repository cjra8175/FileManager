/* !v1-1.0.0.js 2018-01-10 */

function htmlScroll(a){a?(document.body.style.overflow="hidden",document.body.maxHeight=document.documentElement.clientHeight+"px",$("body div.ceng-bg").bind("touchmove",function(a){a.preventDefault()})):($("body div.ceng-bg").unbind("touchmove"),document.body.style.overflow="",document.body.maxHehight="")}var coupons="",is_combat=!1,call=function(){},setResultDetailsValue=function(a){T.Util.isEmpty(a)||a.length;for(var b=0;b<a.length;b++){var c=a[b];T.Util.isEmpty(c)||setRecommendValue(c,b)}T.Util.isEmpty($(".jp3-1").html())&&T.Util.isEmpty($(".jp3-3").html())&&$(".jp3-1").html("暂无数据"),T.Util.isEmpty($(".jp2-1").html())&&$(".jp2-1").html("暂无数据")},setRecommendValue=function(a,b){0==b&&0==a.type?(alterText(a.forcast,a.result,$(".jp1-1"),$(".jp1-2"),$(".jp1-3")),setProbabilityDetails(a)):1==a.type?alterText(a.forcast,a.result,$(".jp2-1"),null,null):2==a.type?alterText(a.forcast,a.result,$(".jp3-1"),null,null):3==a.type&&($(".jp3-2").html("比分"),alterText(a.forcast,a.result,$(".jp3-3"),$(".jp3-4"),null))},setProbabilityDetails=function(a){$(".yc").addClass("yc-chance").show(),$(".yc img").hide(),$(".chance-percent em").html(isEmptyNum(a.rate)),T.Util.isEmpty(a.result)||0==a.is_hit||(T.Util.isEmpty(a.result)||1!=a.is_hit?T.Util.isEmpty(a.result)||-1!=a.is_hit||($(".yc img").attr("src","../images/ic_no_hit.png").show(),$(".yc").removeClass("yc-chance").addClass("yc-chance-lose").show()):($(".yc img").attr("src","../images/ic_hit.png").show(),$(".yc").removeClass("yc-chance").addClass("yc-chance-win").show()))},alterText=function(a,b,c,d,e){if(!T.Util.isEmpty(a))for(var f=a.split(","),g=0;g<f.length;g++)0==g&&null!=c&&c.html(f[0]+" "),1==g&&null!=d&&d.html(f[1]+" "),2==g&&null!=e&&e.html(f[2]+" "),T.Util.isEmpty(b)||b==f[g]&&(0==g?c.css("color","#ff0000"):1==g?d.css("color","#ff0000"):2==g&&e.css("color","#ff0000"))},buy=function(){var a=function(a,b){$(".userName").html(T.Storage.get("userinfo").nick_name),$(".userZS").html(T.Storage.get("userinfo").diamend);var c=f(a),d=!0;if(c.length)for(var e=0;e<c.length;e++){var i=c[e].diamond;(-1==i||new Number(i)+parseFloat(T.Storage.get("userinfo").diamend)>=a)&&(d=!1)}a>parseFloat(T.Storage.get("userinfo").diamend)&&(T.Util.isEmpty(c)||0==c.length)||c.length&&d?g(!0,a,b):!T.Util.isEmpty(c)&&c.length>0&&a>parseFloat(T.Storage.get("userinfo").diamend)?h(c,b,!0,a):c.length>0?h(c,b,!1,a):g(!1,a,b)},b=function(b,c,d){if(is_combat=d,T.Util.isEmpty(T.Storage.get("access_token"))||T.Util.isEmpty(T.Storage.get("userinfo")))return void T.Util.login();if(!T.Util.isEmpty(c)){if(0==(b=parseFloat(b)))return void r(c);$("#payType li").remove(),l(a,b,c),$(".ceng-bg").off().Touch(function(){q(!1),$("#pay-con").removeClass("tj-show").addClass("tj-hide"),$("#ye-no").removeClass("tj-show").addClass("tj-hide"),setTimeout(function(){$("#pay-con,#ye-no").css("display","none")},300),$(".ceng-bg").hide()})}},c=function(a,c,d){var e=$(a).attr("is_bought"),f=$(a).attr("recom_id"),g=$(a).attr("price"),h=$(a).attr("is_self"),i=$(a).attr("recom_status"),j=$(a).attr("is_hit");if(1==e||1==h||1==d||!T.Util.isEmpty(j)&&0!=j||!T.Util.isEmpty(i)&&10!=i){if(1==c){var k=T.Util.getRootPath()+"/"+Global.webRoot+"/game/betPlan.html?recom_id="+f+"&is_combat=1&sType="+sType;return void T.Util.openWindow(k)}return void T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/recommend/tjDetail.html?recom_id="+f+"&sType="+sType)}if(T.Util.isEmpty(T.Storage.get("access_token")))return void T.Util.login();1==c?b(g,f,1):b(g,f)},d=function(a){var b={crt_user_service:{access_token:T.Storage.get("access_token"),package_id:a.recom_id,match_id:a.mid,price:a.price}};T.Util.xmlHttpRequest({type:"post",reqUrl:"/app-web/api/service/crt_user_service",reqData:b,callback:function(){T.User.getUInfo(T.Storage.get("access_token"),function(){var b=T.Storage.get("userinfo");$(".moneyzs").html(T.Util.parseNumber(b.diamend)),tip("购买成功"),p(),T.Util.xmlHttpRequest({type:"get",reqUrl:"/app-web/api/match/qry_match_jiepan?match_id="+a.mid+"&access_token="+T.Storage.get("access_token"),callback:function(b){if($(".dingyue").hide(),T.Util.isEmpty(b.qry_match_jiepan)||T.Util.isEmpty(b.qry_match_jiepan.forcast))return void $(".jpImg").show();var c=b.qry_match_jiepan.forcast;return $(".dingyue ").attr("is_bought",c.is_bought),$(".dingyue ").attr("price",c.price),$(".dingyue ").attr("recom_id",c.package_id),$(".dingyue ").attr("mid",T.Util.getPara("m_id")),setTimeout(function(){T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/game/jpDetail.html?matchId="+a.mid)},200),1==c.is_select&&5!=c.status_cd?1!=c.is_bought?($(".dingyue").show(),$(".dingyueContent").html(c.tip),$(".dingyueCount").html("已有"+c.buy_num+"人订阅"),0!=c.price?$(".dingyuePrice").html(c.price+"钻查看"):$(".dingyuePrice").html("免费查看"),$(".jpImg").hide(),void $(".dingyue").off().Touch(function(){T.Util.isEmpty(T.Storage.get("access_token"))?T.Util.login():buy().jiepanBuy(this)})):null==c.forcasts||0==c.forcasts.length?void $(".jpImg").show():($(".jp-list,.yc").show(),$(".jpImg").hide(),setResultDetailsValue(c.forcasts),void 0):null==c.forcasts||0==c.forcasts.length?void $(".jpImg").show():($(".jp-list,.yc").show(),$(".jpImg").hide(),void setResultDetailsValue(c.forcasts))},errorCallback:function(a){$(".jpImg").show()}})})},errorCallback:function(a){}})},e=function(a){var b={};b.recom_id=$(a).attr("recom_id"),b.price=$(a).attr("price"),b.mid=$(a).attr("mid");var c=T.Storage.get("userinfo");$(".userName").html(c.nick_name),$(".userZS").html(c.diamend),c.diamend<parseInt(b.price)?($("#ye-no .act-2").html("立即充值").attr("isBuy","2"),$("#ye-no .weebox-t1").html("您的余额不足,请马上充值")):($("#ye-no .weebox-t1").html("本场解盘"+b.price+"钻,是否购买？"),$("#ye-no .act-2").html("立即购买").attr("isBuy","1")),"none"==$("#ye-no").css("display")&&($(".ceng-bg").show(),$("#ye-no").css("display","block").removeClass("tj-hide").addClass("tj-show")),q(!0),n(b,1),o(),$(".ceng-bg").off().Touch(function(){q(!1),$("#pay-con").removeClass("tj-show").addClass("tj-hide"),$("#ye-no").removeClass("tj-show").addClass("tj-hide"),setTimeout(function(){$("#pay-con,#ye-no").css("display","none")},300),$(".ceng-bg").hide()})},f=function(a){var b=[];if(T.Util.isEmpty(coupons)||0==coupons.length)return b;for(var c=0;c<coupons.length;c++)-1!=coupons[c].diamond?a<=new Number(coupons[c].diamond)+parseFloat(T.Storage.get("userinfo").diamend)&&b.push(coupons[c]):b.push(coupons[c]);return b},g=function(a,b,c){htmlScroll(1),a?($("#ye-no .act-2").html("立即充值").attr("isBuy","2"),$("#ye-no .weebox-t1").html("抱歉您的余额不足,请充值")):($("#ye-no .weebox-t1").html("本场推荐"+b+"钻,是否购买？"),$("#ye-no .act-2").html("立即购买").attr("isBuy","1")),$(".ceng-bg").show(),$("#ye-no").removeClass("tj-hide").addClass("tj-show").show(),q(!0),n(c),o()},h=function(a,b,c,d){for(var e=[],f=0;f<a.length;f++)e.push('<li item_type="'+a[f].item_type+'" class="zsj"  item-zsj = '+a[f].diamond+'>                            <span class="pay-name">'+m(a[f].diamond)+'</span>                            <span class="pay-quan">'+isEmpty(a[f].expire_day)+'</span>                            <span class="pay-select"></span>                            </li>');$("#payType").html(e.join("")).css({"max-height":"153px","overflow-y":"auto","-webkit-overflow-scrolling":"touch"}),$(".fice").remove(),$(".pay-list").prepend('<div class="select fice"><span class="pay-name">余额支付:<span id="oneBalance">'+d+"</span>钻</span></div>"),$(".rec-pay-list").prepend('<div class="select fice"><span class="pay-name">余额支付:<span id="oneBalance">'+d+"</span>钻</span></div>"),"none"==$("#pay-con").css("display")&&($(".ceng-bg").show(),$("#pay-con").removeClass("tj-hide").addClass("tj-show").show()),c&&($("#payType li").eq(0).addClass("select"),"-1"==$("#payType li").eq(0).attr("item-zsj")?$("#oneBalance").html(0):a[0].diamond>=d?$("#oneBalance").html(0):$("#oneBalance").html(Math.abs(a[0].diamond-d))),$("#payType li").off().Touch(function(){if($(this).hasClass("zsj")){$(this).siblings(".zsj").removeClass("select");var a=$(this).attr("item-zsj"),b=a>=d?0:"-1"==a?0:d-a;b=b<0?Math.abs(b):b,$("#oneBalance").html(b)}$(this).toggleClass("select"),$(".zsj").hasClass("select")||$("#oneBalance").html(d)}),q(!0),n(b),o()},i=function(a,b){htmlScroll();var c="",d="",e="";if(!b&&document.getElementById("payType")&&$("#payType li.select").length)for(var f=$("#payType li"),g=0;g<f.length;g++)if($(f[g]).hasClass("select")&&$(f[g]).hasClass("zsj")){c=$(f[g]).attr("item_type");break}!b&&document.getElementById("payType")&&$("#payType li.select").length&&"0"!=$("#oneBalance").html()&&(d=1,e=$("#oneBalance").html());var h={buy_recom:{access_token:T.Storage.get("access_token"),recom_id:a,item_type:c,pay_type:d,money:e}};T.Util.xmlHttpRequest({type:"post",reqUrl:"/app-web/api/recom/buy_recom",errorType:!1,reqData:h,callback:function(c){if(T.User.getUInfo(T.Storage.get("access_token"),function(){$(".userZS").html(T.Storage.get("userinfo").diamend)}),T.Util.isEmpty(call)||call(),b)p(),is_combat?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/game/betPlan.html??recom_id="+a+"&is_combat=1&sType="+sType):T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/recommend/tjDetail.html?recom_id="+a+"&sType="+sType);else{tip("恭喜您，购买成功"),p();var d="";T.Util.isEmpty(c.buy_recom)&&T.Util.isEmpty(c.buy_recom.result_val)&&0!=c.buy_recom.result_val&&(d=c.buy_recom.result_val),is_combat?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/game/betPlan.html?recom_id="+a+"&is_combat=1&sType="+sType):T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/recommend/tjDetail.html?recom_id="+a+"&jinbiCount="+d+"&sType="+sType)}},errorCallback:function(b){j(b,a)}})},j=function(a,b){var c=a.result_code;1509==c||1304==c?(T.Util.isEmpty(call)||call(),p()):1510==c||1307==c||1308==c?(T.Util.isEmpty(call)||call(),is_combat?T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/game/betPlan.html?recom_id="+b+"&is_combat=1"):T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/recommend/tjDetail.html?recom_id="+b),p()):1301==c?(p(),T.User.getUInfo(T.Storage.get("access_token"))):(tip("购买失败"),p())},k=function(a){call=a},l=function(a,b,c){T.Util.xmlHttpRequest({type:"get",reqUrl:"/forum/api/user/qry_coupons?access_token="+T.Storage.get("access_token")+"&is_used=0&acct_type=100",callback:function(d){if(T.Util.isEmpty(d.qry_coupons)||T.Util.isEmpty(d.qry_coupons.data)||T.Util.isEmpty(d.qry_coupons.data.length<=0))return coupons="",void(a&&a(b,c));coupons=d.qry_coupons.data,a&&a(b,c)},errorCallback:function(d){coupons="",a&&a(b,c)}})},m=function(a){return T.Util.isEmpty(a)||-1==a?"无面额优惠券支付":a+"钻优惠券支付"},n=function(a,b){$(".act-2").off().Touch(function(){var c=$(this).attr("isBuy");T.Util.isEmpty(c)||1==c?b?d(a):i(a,!1):(T.Util.openWindow(T.Util.getRootPath()+"/"+Global.webRoot+"/shangcheng/shoppingMall.html?type=ZS"),p())})},o=function(){$(".weebox-action .act-1").off().Touch(function(){p()})},p=function(){htmlScroll(),q(!1),$("#pay-con").removeClass("tj-show").addClass("tj-hide"),$("#ye-no").removeClass("tj-show").addClass("tj-hide"),setTimeout(function(){$("#pay-con,#ye-no").css("display","none")},300),$(".ceng-bg").hide()},q=function(a){},r=function(a){i(a,!0)};return{buyDialog:b,loadCoupons:l,callback:k,buyRecommend:c,amendBody:q,jiepanBuy:e}};