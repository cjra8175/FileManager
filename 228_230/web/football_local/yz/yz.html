<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
	<title>手机验证</title>
	<link rel="stylesheet" href="../css/main.css">
	<link href="css/yz.css" type="text/css" rel="stylesheet">
</head>
<script>if(/iPhone|iPad|iPod|ios|IOS/.test(window.navigator.userAgent)){var head=document.getElementsByTagName("head")[0],styleLink=document.createElement("link");styleLink.setAttribute("rel","stylesheet"),styleLink.setAttribute("href","../css/iosBar.css"),head.appendChild(styleLink)}</script>

<body>
<header class="sq_header" id="inHead">
	<div class="sq_headerUpBox" id="back"><b class="icon sq_headerUp"></b></div>
	<span class="sq_headerText">手机绑定</span>
</header>
	<section class="yz-con" id="bandPhone" style="padding-top:80px">
		<p class="yz-tips">请输入您要绑定的手机号码</p>
		<div class="yz-box">
			<ul class="yz-list">
				<li><i class="phone-icon"></i><input type="tel" class="yz-input" placeholder="请输入您的手机号码" maxlength="11" id="phone"></li>
				<li><i class="yzm-icon"></i><input type="tel" class="yz-input" placeholder="请输入验证码" id="yzm" maxlength="4"><span class="yzm-btn">获取验证码</span><span class="yzm-send hide">重新发送60</span></li>
			</ul>
			<span class="send-btn" id="bandBtn">提交</span>
		</div>
	</section>
	<section class="yz-con hide" id="setPwd" style="padding-top:80px">
		<p class="yz-tips">为您创建账号密码</p>
		<div class="yz-box">
			<ul class="yz-list">
				<li><i class="password-icon"></i><input type="password" class="yz-input" placeholder="请设置您的密码" id="password"></li>

			</ul>
			<span class="send-btn" id="setBtn">提交</span>
		</div>
	</section>
	<div class="tipBox hide">验证码发送成功</div>

	
	<div class="yz-weebox hide" id="successBox">
		<div class="yz-bg"></div>
		<div class="yz-w1">
			<div class="w1-title">关联成功</div>
			<article class="w1-tips">您的手机号码已注册其他账户，关联手机号码帮助您顺利参与排行榜活动</article>
			<span class="w1-btn">我知道了</span>
		</div>
	</div>
	
	<script src="../js/lib/zeptoPpLoadNativeMap.min.js"></script>
	<script src="../js/main.js"></script>
	<script src="../js/lib/md5.js"></script>
	<script>function getNewTokenStr(){var e="";return T.Util.isEmpty(T.Storage.get("access_token"))||(e=T.Storage.get("access_token")),e}var api=lib.API,isBand=!0,salt="{mobius%key%}",check={tel:function(e){if(""==e)tip("请输入手机号码");else{if(/^1\d{10}$/.test(e))return!0;tip("请输入正确的手机号码")}},pas:function(e){if(""==e)tip("请输入密码！");else{if(!(e.length>16))return!0;tip("请输入6-16位密码！")}}},Init=function(){var e=function(){t()},t=function(){$("#bandBtn").off().Touch(function(){if($(this).hasClass("send-ok"))if($("input").blur(),isBand){if(!check.tel($("#phone").val().trim()))return;if(""==$("#yzm").val())return;var e={relevance_user_info:{access_token:getNewTokenStr(),sms_code:$("#yzm").val(),mobile_phone:$("#phone").val()}};T.Util.xmlHttpRequest({reqUrl:"/auth-web/api/user/relevance_user_info",type:"post",reqData:e,callback:function(){$("input").val(""),$("#successBox").show()},errorCallback:function(){}})}else $("#bandPhone").hide(),$("#setPwd").show(),$("#setBtn").removeClass("send-ok"),$("#setBtn").off().Touch(function(){if($(this).hasClass("send-ok")){if(!check.pas($("#password").val().trim()))return;var e={edit_user_info:{access_token:getNewTokenStr(),mobile_phone:$("#phone").val(),sms_code:$("#yzm").val(),login_pwd:md5($("#password").val()+salt)}};T.Util.xmlHttpRequest({type:"post",reqData:e,reqUrl:"/auth-web/api/user/edit_user_info",callback:function(e){$("input").val(""),tip("绑定成功"),setTimeout(function(){window.history.back()},2e3)},errorCallback:function(){}})}})}),$(".yzm-btn").off().Touch(function(){if(check.tel($("#phone").val().trim())){var e=60,t=setInterval(function(){e--,$(".yzm-btn").hide(),$(".yzm-send").show().html("重新发送"+e),0==e&&(clearInterval(t),$(".yzm-send").hide(),$(".yzm-btn").show())},1e3),n="/app-web/api/sms/send_sms",s={send_sms:{mobile_phone:$("#phone").val(),busi_type:1002}};T.Util.xmlHttpRequest({hostFlag:"appweb",type:"post",reqData:s,reqUrl:n,errorType:"2",callback:function(e){tip("短信已发送"),isBand=!1},errorCallback:function(e){"1002"==e.result_code&&tip("短信请求过于频繁"),"1102"==e.result_code&&(s={send_sms:{mobile_phone:$("#phone").val(),busi_type:1003}},T.Util.xmlHttpRequest({hostFlag:"appweb",type:"post",reqData:s,reqUrl:n,callback:function(e){tip("短信已发送"),isBand=!0},errorCallback:function(e){}}))}})}}),$(".w1-btn").off().Touch(function(){$("#successBox").hide(),window.history.back()})};return{init:e,addLisenter:t}}();$(function(){11==$("#phone").val().length&&4==$("#yzm").val().length?$(".send-btn").addClass("send-ok"):$(".send-btn").removeClass("send-ok"),Init.init(),$(".yz-input").focus(function(){$(this).prev("i").addClass("on")}).blur(function(){0==$(this).val().length&&$(this).prev("i").removeClass("on")}),$("#phone,#yzm").keyup(function(){var e=11==$("#phone").val().length,t=4==$("#yzm").val().length;return e&&t?$(".send-btn").addClass("send-ok"):$(".send-btn").removeClass("send-ok")}),$("#password").keyup(function(){return $("#password").val().length>=4?$("#setBtn").addClass("send-ok"):$("#setBtn").removeClass("send-ok")})})</script>
</body>
</html>